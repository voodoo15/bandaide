
<h1> Band page <h1>

<h1><%= @band.name %></h1>

<%= image_tag @band.poster.profile %><br />

<h3>Description</h3>
<p>
  <%= @band.description %>
</p>


<h3>Current Positions in Band</h3><br />

<% @band.members.each do |member| %>

  <p>
    <%= member.position.description %>

    <% if musician_signed_in? %>

      <% if member.vacant? %>
        <%= link_to 'Apply', band_member_path(@band, member, member: {musician_id: current_musician.id}), :method => :put %>
      <% else %>
        <%= member.musician.firstname%>
      <% end %>

      <% if @band.leader.id == current_musician.id %>
        <%= link_to 'Remove', band_member_path(@band, member.id),
                data: {:confirm => 'Are you sure?'}, :method => :delete %>
      <% end %>

    <%else %>

      <p>
        Please register to apply
      </p>
    <% end %>

  </p>
<% end %>

<% if musician_signed_in? %>
  <% if @band.leader.id == current_musician.id %>

    <%= form_for [@band , @member] do |f| %>

      <div id="field">
        <%= f.label :position %><br />
        <%= f.select :position_id , options_for_select(@positions.collect {|p| [ p.description, p.id] }) %>
        <%= f.hidden_field :musician_id, :value => nil %>
        <%= f.hidden_field :band_id, :value => @band.id %>
      </div>

      <div class="field">
        <%= f.submit %>
      </div>
    <% end %>

  <% end %>

<% end %>

<br /><%= link_to "Back", request.referer.present? ? request.referer : root_path %>
